<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Big K Bullet Dodger - Circle Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  background: black;
  font-family: Arial, sans-serif;
  text-align: center;
  color: #00ff00;
}
canvas {
  display: block;
  margin: 20px auto;
  border: 3px solid #00ff00;
  background: #111;
}
button {
  background: #111;
  color: #00ff00;
  border: 2px solid #00ff00;
  font-size: 16px;
  padding: 10px 20px;
  cursor: pointer;
  margin: 10px;
}
button:hover { background: #222; }
</style>
</head>
<body>

<h1>Big K Bullet Dodger</h1>
<p>Arrow Keys • Dodge Bullets • Collect Pancakes & Syrup</p>
<canvas id="game" width="700" height="400"></canvas>
<button onclick="restartGame()">Restart</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== INPUT ===== */
let keys = {};
document.addEventListener("keydown", e=>keys[e.key]=true);
document.addEventListener("keyup", e=>keys[e.key]=false);

/* ===== PLAYER (circle with combover) ===== */
let player = {x:100, y:200, r:20, speed:5, hp:3, alive:true};

/* ===== GAME STATE ===== */
let bullets=[], powerups=[], frame=0, difficulty=1, slowTime=0;

/* ===== NPC CHARACTER ===== */
let npc = {x:580, y:150, w:100, h:200};

/* ===== SPAWN BULLETS ===== */
function spawnBullet(){
  let side = Math.floor(Math.random()*4);
  let x,y,dx,dy;
  let speed = 5 + difficulty*0.8;
  if(slowTime>0) speed*=0.4;
  if(side===0){x=Math.random()*700;y=-20;dx=0;dy=speed;}
  if(side===1){x=Math.random()*700;y=420;dx=0;dy=-speed;}
  if(side===2){x=-20;y=Math.random()*400;dx=speed;dy=0;}
  if(side===3){x=720;y=Math.random()*400;dx=-speed;dy=0;}
  bullets.push({x,y,dx,dy,w:20,h:12});
}

/* ===== SPAWN POWERUPS ===== */
function spawnPowerup(){
  const type = Math.random()<0.5?"pancake":"syrup";
  powerups.push({x:Math.random()*600+30,y:Math.random()*320+30,type,wobble:0});
}

/* ===== COLLISION ===== */
function collideCircleRect(c,r){
  let distX = Math.abs(c.x - r.x-r.w/2);
  let distY = Math.abs(c.y - r.y-r.h/2);
  if(distX>r.w/2 + c.r) return false;
  if(distY>r.h/2 + c.r) return false;
  if(distX<=r.w/2) return true;
  if(distY<=r.h/2) return true;
  let dx=distX-r.w/2;
  let dy=distY-r.h/2;
  return dx*dx+dy*dy<=c.r*c.r;
}

/* ===== DRAW PLAYER ===== */
function drawPlayer(){
  ctx.fillStyle="#00ffff";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();
  // combover
  ctx.fillStyle="#111";
  ctx.fillRect(player.x-player.r,player.y-15,player.r*2,5);
}

/* ===== DRAW BULLET ===== */
function drawBullet(b){
  ctx.shadowColor="red";
  ctx.shadowBlur=10;
  ctx.fillStyle="#aaa";
  ctx.fillRect(b.x,b.y,b.w,b.h);
  ctx.shadowBlur=0;
}

/* ===== DRAW POWERUPS ===== */
function drawPowerup(p){
  p.wobble=Math.sin(frame/10+p.x)*2;
  if(p.type==="pancake"){
    for(let i=0;i<3;i++){
      ctx.fillStyle="#ffcc66";
      ctx.fillRect(p.x-15,p.y-6*(3-i)+i*4+p.wobble,30,6);
      ctx.fillStyle="#996633";
      ctx.fillRect(p.x-12,p.y-6*(3-i)+i*4+2+p.wobble,24,2);
    }
  } else {
    ctx.fillStyle="#663300";
    ctx.fillRect(p.x-5,p.y-15+p.wobble,10,20);
    ctx.fillStyle="#ffcc00";
    ctx.fillRect(p.x-3,p.y-18+p.wobble,6,5);
  }
}

/* ===== DRAW NPC ===== */
function drawNPC(){
  ctx.fillStyle="#8B5A2B";
  ctx.fillRect(npc.x,npc.y,npc.w,npc.h);
  ctx.beginPath();
  ctx.arc(npc.x+npc.w/2,npc.y-30,40,0,Math.PI*2);
  ctx.fill();
  // eyes
  ctx.fillStyle="white";
  ctx.fillRect(npc.x+npc.w/2-15,npc.y-40,10,10);
  ctx.fillRect(npc.x+npc.w/2+5,npc.y-40,10,10);
  ctx.fillStyle="black";
  ctx.fillRect(npc.x+npc.w/2-12,npc.y-37,4,4);
  ctx.fillRect(npc.x+npc.w/2+8,npc.y-37,4,4);
  // mouth
  ctx.fillStyle="red";
  ctx.fillRect(npc.x+npc.w/2-15,npc.y-15,30,5);
}

/* ===== RESTART ===== */
function restartGame(){
  player.x=100;player.y=200;player.hp=3;player.alive=true;
  bullets=[];powerups=[];frame=0;slowTime=0;difficulty=1;
}

/* ===== GAME LOOP ===== */
function update(){
  ctx.clearRect(0,0,700,400);
  frame++;
  difficulty=Math.min(10,1+frame/400);
  if(slowTime>0) slowTime--;

  if(player.alive){
    if(keys["ArrowUp"]) player.y-=player.speed;
    if(keys["ArrowDown"]) player.y+=player.speed;
    if(keys["ArrowLeft"]) player.x-=player.speed;
    if(keys["ArrowRight"]) player.x+=player.speed;
    player.x=Math.max(player.r,Math.min(700-player.r,player.x));
    player.y=Math.max(player.r,Math.min(400-player.r,player.y));
  }

  drawPlayer();

  // bullets
  bullets.forEach((b,i)=>{
    b.x+=b.dx;b.y+=b.dy;
    drawBullet(b);
    if(collideCircleRect(player,b)){
      bullets.splice(i,1);
      player.hp--;
      if(player.hp<=0) player.alive=false;
    }
  });
  bullets = bullets.filter(b=>b.x>-30 && b.x<730 && b.y>-30 && b.y<430);

  // powerups
  powerups.forEach((p,i)=>{
    drawPowerup(p);
    if(collideCircleRect(player,{x:p.x-15,y:p.y-15,w:30,h:30})){
      if(p.type==="pancake") player.hp=Math.min(player.hp+1,3);
      else slowTime=240;
      powerups.splice(i,1);
    }
  });

  // NPC speech
  let bubbleY = npc.y-80 + Math.sin(frame/20)*5;
  ctx.fillStyle="white";
  ctx.font="14px Arial";
  ctx.fillText("Gabbagool, mustard,",npc.x-180,bubbleY);
  ctx.fillText("diddybluds & pancakes!",npc.x-180,bubbleY+18);

  // HUD
  ctx.fillStyle="#00ff00";
  ctx.font="16px Arial";
  ctx.fillText("HP: "+player.hp,10,20);
  ctx.fillText("DIFFICULTY: "+difficulty.toFixed(1),10,40);

  if(frame%20===0) spawnBullet();
  if(frame%300===0) spawnPowerup();

  if(!player.alive){
    ctx.fillStyle="red";
    ctx.font="40px Arial";
    ctx.fillText("GAME OVER",250,200);
  }

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
