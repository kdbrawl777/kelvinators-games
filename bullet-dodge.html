<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Big K Bullet Dodger</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    margin: 0;
    background: black;
    color: #00ff00;
    font-family: Arial, sans-serif;
    text-align: center;
  }
  canvas {
    background: #111;
    border: 3px solid #00ff00;
    display: block;
    margin: 20px auto;
  }
</style>
</head>
<body>

<h1>Big K Bullet Dodger</h1>
<p>Arrow Keys • Dodge Bullets • Eat Pancakes</p>

<canvas id="game" width="600" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== INPUT ===== */
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

/* ===== PLAYER ===== */
let player = {
  x: 300,
  y: 200,
  r: 14,
  speed: 5,
  hp: 3,
  hitFlash: 0,
  shield: false,
  alive: true
};

/* ===== GAME STATE ===== */
let bullets = [];
let powerups = [];
let frame = 0;
let difficulty = 1;
let slowTime = 0;

/* ===== BULLETS ===== */
function spawnBullet() {
  const side = Math.floor(Math.random() * 4);
  let x, y, dx, dy;

  let speed = 5 + difficulty * 0.7;
  if (slowTime > 0) speed *= 0.4;

  if (side === 0) { x = Math.random()*600; y = -30; dx = 0; dy = speed; }
  if (side === 1) { x = Math.random()*600; y = 430; dx = 0; dy = -speed; }
  if (side === 2) { x = -30; y = Math.random()*400; dx = speed; dy = 0; }
  if (side === 3) { x = 630; y = Math.random()*400; dx = -speed; dy = 0; }

  bullets.push({x, y, dx, dy, w: 24, h: 8});
}

/* ===== POWERUPS (PIXEL PANCAKES) ===== */
function spawnPowerup() {
  powerups.push({
    x: Math.random() * 540 + 30,
    y: Math.random() * 340 + 30,
    type: Math.random() < 0.5 ? "shield" : "slow",
    r: 12
  });
}

/* ===== COLLISION ===== */
function rectCircle(rx, ry, rw, rh, cx, cy, cr) {
  let testX = Math.max(rx, Math.min(cx, rx + rw));
  let testY = Math.max(ry, Math.min(cy, ry + rh));
  let dx = cx - testX;
  let dy = cy - testY;
  return dx*dx + dy*dy < cr*cr;
}

/* ===== DRAW PLAYER WITH COMBOVER ===== */
function drawPlayer() {
  // body
  ctx.fillStyle = player.hitFlash > 0 ? "red" : "#00ff00";
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
  ctx.fill();

  // IMPROVED PIXEL COMBOVER
  ctx.fillStyle = "#003300";
  for(let i=0;i<6;i++){
    ctx.fillRect(player.x-9 + i*4, player.y-13+i, 4,2);
  }

  // shield
  if(player.shield){
    ctx.strokeStyle="#00ffff";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.r+6,0,Math.PI*2);
    ctx.stroke();
  }
}

/* ===== DRAW POWERUPS (PIXEL PANCAKES WITH SYRUP) ===== */
function drawPowerup(p){
  // pancake (tan square)
  ctx.fillStyle="#ffcc66";
  ctx.fillRect(p.x-p.r,p.y-p.r,p.r*2,p.r*2);
  // syrup lines (dark brown pixels)
  ctx.fillStyle="#996633";
  for(let i=0;i<3;i++){
    ctx.fillRect(p.x-6,p.y-4+i*2,12,1);
  }
}

/* ===== LOOP ===== */
function update(){
  if(!player.alive){
    ctx.fillStyle="red";
    ctx.font="40px Arial";
    ctx.fillText("GAME OVER",150,200);
    return;
  }

  ctx.clearRect(0,0,600,400);
  frame++;
  difficulty = 1 + frame/400;

  if(slowTime>0) slowTime--;
  if(player.hitFlash>0) player.hitFlash--;

  // move
  if(keys["ArrowUp"]) player.y -= player.speed;
  if(keys["ArrowDown"]) player.y += player.speed;
  if(keys["ArrowLeft"]) player.x -= player.speed;
  if(keys["ArrowRight"]) player.x += player.speed;

  player.x = Math.max(14, Math.min(586, player.x));
  player.y = Math.max(14, Math.min(386, player.y));

  drawPlayer();

  // bullets
  bullets.forEach((b,i)=>{
    b.x+=b.dx; b.y+=b.dy;

    // red glow
    ctx.shadowColor="red";
    ctx.shadowBlur=12;
    // bullet casing
    ctx.fillStyle="#aaa";
    ctx.fillRect(b.x,b.y,b.w,b.h);
    ctx.fillStyle="#666";
    ctx.fillRect(b.x+b.w-6,b.y,6,b.h);
    ctx.shadowBlur=0;

    if(rectCircle(b.x,b.y,b.w,b.h,player.x,player.y,player.r)){
      bullets.splice(i,1);
      if(player.shield){player.shield=false;}
      else{
        player.hp--;
        player.hitFlash=15;
        if(player.hp<=0){player.hp=0; player.alive=false;}
      }
    }
  });
  bullets=bullets.filter(b=>b.x>-80 && b.x<680 && b.y>-80 && b.y<480);

  // powerups
  powerups.forEach((p,i)=>{
    drawPowerup(p);
    let dx=player.x-p.x; let dy=player.y-p.y;
    if(Math.sqrt(dx*dx+dy*dy)<player.r+p.r){
      if(p.type==="shield") player.shield=true;
      if(p.type==="slow") slowTime=240;
      powerups.splice(i,1);
    }
  });

  // HUD
  ctx.fillStyle="#00ff00";
  ctx.font="16px Arial";
  ctx.fillText("HP: "+player.hp,10,20);
  ctx.fillText("DIFFICULTY: "+difficulty.toFixed(1),10,40);
  if(slowTime>0) ctx.fillText("SLOW TIME",470,20);

  // SPAWNS
  if(frame%20===0) spawnBullet();
  if(frame%300===0) spawnPowerup();

  requestAnimationFrame(update);
}

update();
</script>

</body>
</html>
