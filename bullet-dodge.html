<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Big K Bullet Dodger</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  background: #111;
  font-family: Arial, sans-serif;
  text-align: center;
  color: #00ff00;
}
canvas {
  display: block;
  margin: 20px auto;
  border: 3px solid #00ff00;
  background: #111;
}
button {
  background: #111;
  color: #00ff00;
  border: 2px solid #00ff00;
  font-size: 16px;
  padding: 10px 20px;
  cursor: pointer;
  margin: 10px;
}
button:hover { background: #222; }
</style>
</head>
<body>

<h1>Big K Bullet Dodger</h1>
<p>Arrow Keys • Dodge Bullets • Collect Pancakes, Syrup, and Shield</p>
<canvas id="game" width="800" height="450"></canvas>
<button onclick="restartGame()">Restart</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== INPUT ===== */
let keys = {};
document.addEventListener("keydown", e => keys[e.key]=true);
document.addEventListener("keyup", e => keys[e.key]=false);

/* ===== PLAYER ===== */
let player = {
  x:100, y:225, r:20, speed:5,
  hp:3, alive:true, shield:0,
  comboverOffset:0
};

/* ===== GAME STATE ===== */
let bullets=[], powerups=[], frame=0, difficulty=1, slowTime=0;

/* ===== NPC ===== */
let npc = {x:650, y:200, w:120, h:220, armAngle:0, armDir:1, mouthOffset:0};

/* ===== NPC SPEECH ===== */
let npcLines = [
  "CITY BOIII CITY BOIIII",
  "gabbagool",
  "meet me in the hallway",
  "Oh no my hair fell out nooooo",
  "No shady shikis allowed",
  "stop being freinds with them",
  "Why are you the big k",
  "to my office NOW",
  "you still thinking about them pancakes?"
];
let currentLine = npcLines[0];
let lineFrame = 0;

/* ===== SPAWN BULLETS ===== */
function spawnBullet(){
  let side=Math.floor(Math.random()*4);
  let x,y,dx,dy;
  let speed = 4 + difficulty*0.8;
  if(slowTime>0) speed*=0.4;
  if(side===0){x=Math.random()*800;y=-20;dx=0;dy=speed;}
  if(side===1){x=Math.random()*800;y=470;dx=0;dy=-speed;}
  if(side===2){x=-20;y=Math.random()*450;dx=speed;dy=0;}
  if(side===3){x=820;y=Math.random()*450;dx=-speed;dy=0;}
  bullets.push({x,y,dx,dy,w:20,h:12});
}

/* ===== SPAWN POWERUPS ===== */
function spawnPowerup(){
  let typeRand=Math.random();
  let type = typeRand<0.4?"pancake":typeRand<0.7?"syrup":"shield";
  powerups.push({x:Math.random()*700+50,y:Math.random()*350+50,type,wobble:0, sparkle:Math.random()*360});
}

/* ===== COLLISION ===== */
function collideCircleRect(c,r){
  let distX=Math.abs(c.x-(r.x+r.w/2));
  let distY=Math.abs(c.y-(r.y+r.h/2));
  if(distX>r.w/2 + c.r) return false;
  if(distY>r.h/2 + c.r) return false;
  if(distX<=r.w/2) return true;
  if(distY<=r.h/2) return true;
  let dx=distX-r.w/2;
  let dy=distY-r.h/2;
  return dx*dx+dy*dy<=c.r*c.r;
}

/* ===== DRAW PLAYER ===== */
function drawPlayer(){
  // combover movement
  if(keys["ArrowLeft"]) player.comboverOffset=-4;
  else if(keys["ArrowRight"]) player.comboverOffset=4;
  else player.comboverOffset=0;

  if(player.shield>0){
    ctx.strokeStyle="cyan";
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.r+4,0,Math.PI*2);
    ctx.stroke();
  }
  ctx.fillStyle="#00ffff";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();
  // combover
  ctx.fillStyle="#111";
  ctx.fillRect(player.x-player.r+player.comboverOffset,player.y-15,player.r*2,5);
}

/* ===== DRAW BULLET ===== */
function drawBullet(b){
  ctx.shadowColor="red";
  ctx.shadowBlur=10;
  ctx.fillStyle="#aaa";
  ctx.fillRect(b.x,b.y,b.w,b.h);
  ctx.shadowBlur=0;
}

/* ===== DRAW POWERUPS ===== */
function drawPowerup(p){
  p.wobble=Math.sin(frame/10+p.x)*4;
  p.sparkle+=10;
  let s=Math.sin(p.sparkle/10)*3;
  if(p.type==="pancake"){
    for(let i=0;i<3;i++){
      ctx.fillStyle="#ffcc66";
      ctx.fillRect(p.x-15,p.y-6*(3-i)+i*4+p.wobble,30,6);
      ctx.fillStyle="#996633";
      ctx.fillRect(p.x-12,p.y-6*(3-i)+i*4+2+p.wobble,24,2);
      // little sparkle
      ctx.fillStyle="#fff";
      ctx.fillRect(p.x+Math.random()*20-10,p.y+Math.random()*6-3+p.wobble,1,1);
    }
  } else if(p.type==="syrup"){
    ctx.fillStyle="#663300";
    ctx.fillRect(p.x-5,p.y-15+p.wobble,10,20);
    ctx.fillStyle="#ffcc00";
    ctx.fillRect(p.x-3,p.y-18+p.wobble,6,5);
    ctx.fillStyle="#fff";
    ctx.fillRect(p.x+Math.sin(frame/5)*3,p.y+Math.cos(frame/5)*3+p.wobble,1,1);
  } else if(p.type==="shield"){
    ctx.fillStyle="#0ff";
    ctx.fillRect(p.x-10,p.y-10+p.wobble,20,20);
    ctx.fillStyle="#00a";
    ctx.fillRect(p.x-6,p.y-6+p.wobble,12,12);
  }
}

/* ===== DRAW NPC ===== */
function drawNPC(){
  // body
  ctx.fillStyle="#8B5A2B";
  ctx.fillRect(npc.x,npc.y,npc.w,npc.h);
  // head
  ctx.beginPath();
  ctx.arc(npc.x+npc.w/2,npc.y-40,40,0,Math.PI*2);
  ctx.fill();
  // eyes
  ctx.fillStyle="white";
  ctx.fillRect(npc.x+npc.w/2-15,npc.y-50,10,10);
  ctx.fillRect(npc.x+npc.w/2+5,npc.y-50,10,10);
  ctx.fillStyle="black";
  ctx.fillRect(npc.x+npc.w/2-12,npc.y-47,4,4);
  ctx.fillRect(npc.x+npc.w/2+8,npc.y-47,4,4);
  // mouth
  npc.mouthOffset=Math.sin(frame/10)*5;
  ctx.fillStyle="red";
  ctx.fillRect(npc.x+npc.w/2-15,npc.y-25+npc.mouthOffset,30,5);
  // arms flail
  npc.armAngle+=0.05*npc.armDir;
  if(npc.armAngle>0.5||npc.armAngle<-0.5) npc.armDir*=-1;
  ctx.strokeStyle="#8B5A2B";
  ctx.lineWidth=8;
  // left arm
  ctx.beginPath();
  ctx.moveTo(npc.x+10,npc.y+50);
  ctx.lineTo(npc.x+10+Math.sin(npc.armAngle)*40,npc.y+50+Math.cos(npc.armAngle)*40);
  ctx.stroke();
  // right arm holding pancakes
  ctx.beginPath();
  ctx.moveTo(npc.x+npc.w-10,npc.y+50);
  ctx.lineTo(npc.x+npc.w-10+Math.sin(-npc.armAngle)*40,npc.y+50+Math.cos(-npc.armAngle)*40);
  ctx.stroke();
  // pancakes in right hand
  ctx.fillStyle="#ffcc66";
  for(let i=0;i<3;i++){
    ctx.fillRect(npc.x+npc.w+20,npc.y+45-6*i,30,6);
    ctx.fillStyle="#996633";
    ctx.fillRect(npc.x+npc.w+23,npc.y+47-6*i,24,2);
    ctx.fillStyle="#ffcc66";
  }
}

/* ===== RESTART ===== */
function restartGame(){
  player.x=100;player.y=225;player.hp=3;player.alive=true;player.shield=0;player.comboverOffset=0;
  bullets=[];powerups=[];frame=0;slowTime=0;difficulty=1;
}

/* ===== GAME LOOP ===== */
function update(){
  ctx.clearRect(0,0,800,450);
  frame++;
  difficulty=Math.min(10,1+frame/400);
  if(slowTime>0) slowTime--;

  // move player
  if(player.alive){
    if(keys["ArrowUp"]) player.y-=player.speed;
    if(keys["ArrowDown"]) player.y+=player.speed;
    if(keys["ArrowLeft"]) player.x-=player.speed;
    if(keys["ArrowRight"]) player.x+=player.speed;
    player.x=Math.max(player.r,Math.min(800-player.r,player.x));
    player.y=Math.max(player.r,Math.min(450-player.r,player.y));
    if(player.shield>0) player.shield--;
  }

  drawPlayer();

  // bullets
  bullets.forEach((b,i)=>{
    b.x+=b.dx; b.y+=b.dy;
    drawBullet(b);
    if(player.alive && collideCircleRect(player,b)){
      if(player.shield<=0) player.hp--;
      bullets.splice(i,1);
      if(player.hp<=0) player.alive=false;
    }
  });
  bullets = bullets.filter(b=>b.x>-30 && b.x<830 && b.y>-30 && b.y<480);

  // powerups
  powerups.forEach((p,i)=>{
    drawPowerup(p);
    if(collideCircleRect(player,{x:p.x-15,y:p.y-15,w:30,h:30})){
      if(p.type==="pancake") player.hp=Math.min(player.hp+1,3);
      else if(p.type==="syrup") slowTime=670;
      else if(p.type==="shield") player.shield=267;
      powerups.splice(i,1);
    }
  });

  // NPC speech
  lineFrame++;
  if(lineFrame%240===0){ // every 4 seconds
    currentLine = npcLines[Math.floor(Math.random()*npcLines.length)];
  }
  let bubbleY=npc.y-90 + Math.sin(frame/20)*5;
  ctx.fillStyle="white";
  ctx.font="14px Arial";
  ctx.fillText(currentLine,npc.x-250,bubbleY);

  drawNPC();

  // HUD
  ctx.fillStyle="#00ff00";
  ctx.font="16px Arial";
  ctx.fillText("HP: "+player.hp,10,20);
  ctx.fillText("DIFFICULTY: "+difficulty.toFixed(1),10,40);
  ctx.fillText("SLOW TIME: "+slowTime,10,60);
  ctx.fillText("SHIELD: "+player.shield,10,80);

  // spawn bullets and powerups
  if(frame%20===0) spawnBullet();
  if(frame%300===0) spawnPowerup();

  if(!player.alive){
    ctx.fillStyle="red";
    ctx.font="40px Arial";
    ctx.fillText("GAME OVER",300,225);
  }

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
